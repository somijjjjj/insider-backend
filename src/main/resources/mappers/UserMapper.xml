<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "file:/D:/Program Files/mybatis-3-mapper.dtd">

<mapper namespace="com.firstproject.insider.user.mapper.UserMapper">

    <!-- 사용자 등록 -->
    <insert id="insertUser" parameterType="com.firstproject.insider.user.dto.request.UserSingUpRequest">
        INSERT INTO user (
            user_id, password, nickname, email, birth_date, gender, agree_terms, agree_privacy
        ) VALUES (
            #{userId}
            , #{password}
            , #{nickName}
            , #{email}
            , #{birthDate}
            , #{gender}
            , #{agreeTerms}
            , #{agreePrivacy}
        )
    </insert>

    <!-- 사용자 권한 등록 -->
    <insert id="insertUserAuth">
        INSERT INTO user_auth (
            user_id, auth_role
        ) VALUES (
            #{userId}
            , #{role}
        )
    </insert>

    <!-- 사용자 아이디 중복 확인 -->
    <select id="checkUserId" resultType="int">
        SELECT COUNT(1)
          FROM user
         WHERE user_id = #{userId}
    </select>

    <!-- 이메일 중복 확인 -->
    <select id="checkEmail" resultType="int">
        SELECT COUNT(1)
          FROM user
         WHERE email = #{email}
    </select>

    <!-- 로그인 정보 조회 -->
    <select id="selectLoginInfo" resultType="string" >
        SELECT password
          FROM user
         WHERE user_id = #{userId}
    </select>

    <!-- 계정 아이디 조회 -->
    <select id="selectUserIdByEmail" resultType="string">
        SELECT user_id
          FROM user
         WHERE email = #{email}
    </select>

    <!-- 계정 이메일 조회 -->
    <select id="selectEmailByUserId" resultType="string">
        SELECT email
          FROM user
         WHERE user_id = #{userId}
    </select>

    <!-- 비밀번호 업데이트 -->
    <update id="updateUserPassword">
        UPDATE user
           SET password = #{encodedPassword}
         WHERE user_id = #{userId}
    </update>
    
</mapper>